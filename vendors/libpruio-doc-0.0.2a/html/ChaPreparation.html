<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>libpruio: Preparation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="pruio.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pruio_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">libpruio
   &#160;<span id="projectnumber">0.0.2</span>
   </div>
   <div id="projectbrief">AM33xx-PRU driver for digital input / output and analog input</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ChaPreparation.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Preparation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>When using libpruio you neither need device tree compilers nor overlays for analog or digital pin configurations. All setup gets done in single source inside your program, controlling the driver that is running on a co-processor (PRUSS). All you have to ensure to load the kernel driver for the PRU subsystem and start it once at system startup.</p>
<dl class="section note"><dt>Note</dt><dd>All following installation commands are to be executed with system administrator privilegues on the Beaglebone hardware with a Debian based LINUX operating system.</dd></dl>
<p>Once the library is installed, selected users can use it without the need of admin privilegues.</p>
<h1><a class="anchor" id="SubPreDeps"></a>
Dependencies  </h1>
<p>libpruio is based on <em>libprussdrv</em> from the package <a href="https://github.com/beagleboard/am335x_pru_package">am335x_pru_package</a>. You've to download and install the <a href="http://www.freebasic-portal.de//downloads/fb-on-arm/fb-prussdrv-kit-bbb-324.html">FB prussdrv Kit (de)</a> first. Find English installation instructions in <a href="http://www.freebasic.net/forum/viewtopic.php?f=14&amp;t=22461#p197061">this link at the bottom of the German page</a>.</p>
<p>To compile changes in the examples or in the library source code, you need an ARM version of the FreeBASIC compiler. The binaries in this package were compiled by <a href="http://www.freebasic-portal.de/downloads/fb-on-arm/bbb-fbc-fbc-fuer-beaglebone-black-283.html">BBB-FBC (de)</a>, an english discussion on this project should be available at <a href="http://www.freebasic.net/forum/viewtopic.php?f=5&amp;t=21372">this site</a> (contact admins if the link is still down).</p>
<h1><a class="anchor" id="SubPreSystem"></a>
System preparation  </h1>
<p>To execute software based on libpruio driver you have to ensure that</p>
<ol type="1">
<li>the kernel driver <em>uio_pruss</em> is loaded.</li>
<li>the PRU subsystem is powered on,</li>
<li>the user has read / write privilegues to the <code>/dev/uio5</code> system interrupt</li>
</ol>
<p>The first and second preconditions can be reached at once. Either activate one of the prepared operating systems device tree overlays. Ie. execute</p>
<div class="fragment"><div class="line">sudo echo BB-BONE-PRU-01 &gt; /sys/devices/bone_capemgr.9/slots</div>
</div><!-- fragment --><p>Or you use the minimal overlay provided in the above mentioned FB prussdrv Kit package, which needs to get installed in the right folder (/lib/firmware), first. Then execute</p>
<div class="fragment"><div class="line">sudo echo PRUSSDRV &gt; /sys/devices/bone_capemgr.9/slots`</div>
</div><!-- fragment --><p>Both device tree overlays start the PRUSS and also load the kernel driver. The kernel driver allocates external memory for the PRUSS, which is a default of 256 kB. (See section <a class="el" href="ChaMemory.html#SubERam">External Ram </a> on how to customize this.)</p>
<p>Item 3 can either be reached by running the software as user <code>root</code>. But the prefered method should be installing privilegues for the related users:</p>
<ul>
<li>create a new user group (ie <code>addgroup pruio</code>)</li>
<li>adapt this group to the interrupt device (ie <code>chgrp pruio /dev/uio5</code>)</li>
<li>activate read / write privilegues for this group (ie <code>chmod g+rw /dev/uio5</code>)</li>
<li>and make yourself (and all related users) a member of this group</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Enabling the PRU subsystem may be a safety risk. A virus running at the PRUSS can access each device register or memory area. The kernel running on the host cannot protect the system.</dd></dl>
<h1><a class="anchor" id="SecPrePruio"></a>
Library preparation  </h1>
<p>This package contains a pre-compiled version of the libpruio binaries in the folder src/c_wrapper. It's the universal (all-in) version, including the C wrapper functions. This section is about the installation instructions.</p>
<h2><a class="anchor" id="SubPreFB"></a>
FreeBASIC  </h2>
<p>To install libpruio on your system and use it in your FreeBASIC code, you have to copy the binaries to a folder where the linker can find them. Futhermore copy the headers to a propper place where the compiler can find them. Starting from the basis folder of the unpacked libpruio package and execute:</p>
<div class="fragment"><div class="line">sudo su</div>
<div class="line">cd src/c_wrapper/</div>
<div class="line">cp libpruio.so /usr/local/lib</div>
<div class="line">cp libpruio.a /usr/local/lib</div>
<div class="line">ldconfig</div>
<div class="line">cd ../pruio/</div>
<div class="line">mkdir /usr/local/include/freebasic/BBB</div>
<div class="line">cp pruio.bi /usr/local/include/freebasic/BBB</div>
<div class="line">cp pruio.hp /usr/local/include/freebasic/BBB</div>
<div class="line">cp pruio_pins.bi /usr/local/include/freebasic/BBB</div>
<div class="line">exit</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>For testing only, you can skip the header files (*.bi and *.hp) part. Just execute until ldconfig and then exit.</dd></dl>
<h2><a class="anchor" id="SubPreC"></a>
C Compiler  </h2>
<p>The author isn't a C expert and doesn't know if if this is a propper insatallation. To compile the C examples the following was done (starting from the basis folder of the unpacked libpruio package):</p>
<div class="fragment"><div class="line">sudo su</div>
<div class="line">cd src/c_wrapper/</div>
<div class="line">cp libpruio.so /usr/local/lib</div>
<div class="line">cp libpruio.a /usr/local/lib</div>
<div class="line">ldconfig</div>
<div class="line">cp pruio.h /usr/local/include</div>
<div class="line">cp pruio_c_wrapper.h /usr/local/include</div>
<div class="line">cp pruio_pins.h /usr/local/include</div>
<div class="line">cp ../pruio/pruio.hp /usr/local/include</div>
<div class="line">exit</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>For testing only, you can skip the header files (*.h and *.hp) part. Just execute until ldconfig and then exit. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Jun 6 2014 13:22:55 for libpruio by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
