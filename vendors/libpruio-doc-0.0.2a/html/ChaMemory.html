<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>libpruio: Memory Organisation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="pruio.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pruio_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">libpruio
   &#160;<span id="projectnumber">0.0.2</span>
   </div>
   <div id="projectbrief">AM33xx-PRU driver for digital input / output and analog input</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ChaMemory.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Memory Organisation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>libpruio uses memory to exchange data between the host (ARM) and PRU subsystem. Parameters need to be passed to the PRU subsystem, data get exchanged in both directions. The kernel driver allocates memory areas for that purpose. libpruio uses</p>
<ul>
<li>the PRU specific DRam in IO mode and</li>
<li>both DRam areas and the external memory in MM mode.</li>
</ul>
<p>In IO mode the driver uses DRam-0 when running on PRU-0 and DRam-1 when running on PRU-1 (default). In MM mode further memory is needed to store the measurement data. Therefor libpruio uses the external memory area.</p>
<h1><a class="anchor" id="SubDRam"></a>
DRam  </h1>
<p>The following table shows the memory usage in the DRam area (DRam-0 for PRU-0 or DRam-1 for PRU-1). Some context changes, depending on the current driver function.</p>
<table class="doxtable">
<tr>
<th align="right">Offset </th><th align="center">Size </th><th align="center">Mode </th><th align="left">Context  </th></tr>
<tr>
<td align="right">0 </td><td align="center">4 </td><td align="center">all </td><td align="left">Status </td></tr>
<tr>
<td align="right">4 </td><td align="center">4 </td><td align="center">init </td><td align="left">offset ADC config </td></tr>
<tr>
<td align="right">4 </td><td align="center">4 </td><td align="center">IO </td><td align="left">ball# config update </td></tr>
<tr>
<td align="right">PRUIO_TRG_PARA = 4 </td><td align="center">28 </td><td align="center">MM </td><td align="left">trigger parameters </td></tr>
<tr>
<td align="right">PRUIO_ADC_BUFF = 16 </td><td align="center">16 * 2 </td><td align="center">IO </td><td align="left">ADC sample values </td></tr>
<tr>
<td align="right">PRUIO_GPIO_OFFS = 64 </td><td align="center">4 * PRUIO_GPIO_BLCK = 96 </td><td align="center">all </td><td align="left">GPIO array </td></tr>
<tr>
<td align="right">PRUIO_PIN_OFFS = 256 </td><td align="center">PRUIO_BALL_AZ + 1 = 110 </td><td align="center">all </td><td align="left">PinConf array </td></tr>
<tr>
<td align="right">PRUIO_PIN_OFFS + PRUIO_BALL_AZ + 1 </td><td align="center">4 * PRUIO_GPIO_DATA = 80 </td><td align="center">init </td><td align="left">Initial GPIO configuration </td></tr>
<tr>
<td align="right">PRUIO_PIN_OFFS + PRUIO_BALL_AZ + 1 </td><td align="center"></td><td align="center"></td><td align="left"></td></tr>
<tr>
<td align="right">+ 4 * PRUIO_GPIO_DATA </td><td align="center">PRUIO_ADC_DATA or PRUIO_ADC_EMPTY </td><td align="center">init </td><td align="left">initial ADC configuration </td></tr>
<tr>
<td align="right">PRUIO_PIN_OFFS + PRUIO_BALL_AZ + 1 </td><td align="center">PRUIO_BALL_AZ + 1 = 110 </td><td align="center">all </td><td align="left">PinGpio array </td></tr>
<tr>
<td align="right">PRUIO_ADC_OFFS = 512 </td><td align="center">OFFSETOF(PruIo, DRam) = 192 </td><td align="center">config </td><td align="left">ADC configuration </td></tr>
<tr>
<td align="right">PRUIO_ADC_OFFS = 512 </td><td align="center">(max) 2 * Samples * ChAz </td><td align="center">MM </td><td align="left">sort buffer for pre-trigger </td></tr>
</table>
<p>Check file pruio.hp for the definition of the symbols in this table.</p>
<h1><a class="anchor" id="SubERam"></a>
External Ram </h1>
<p>The external ram is used in MM mode to store the sampled data from the ADC device. Currently, the number of samples in MM mode is limited by the size of the external ram, which is a block of 256 kByte (by default). You can customize the size of the external ram by setting an option in the kernel driver call</p>
<div class="fragment"><div class="line">/sbin/modprobe uio_pruss extram_pool_sz=0x800000</div>
</div><!-- fragment --><p>The mximum size is 8 Mb.</p>
<p>In case of a pre-trigger the starting area of the erternal ram is used as ring buffer. Its datas are invalid during measurement. Don't read them before the function <a class="el" href="structPruIo.html#a708b5bab7c6f7d3d9a0a5329b13855b7">PruIo::mm_start()</a> finished.</p>
<p>The ring buffer gets sorted after measurement and libpruio shifts some data to the DRam area, starting at offset &amp;h200. In worst case, both DRam areas are used for that purpose (depending on the fill level of the ring buffer when the trigger event happens). </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Jun 6 2014 13:22:55 for libpruio by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
